# Dataport

The Dataport is an application that adds value to IoT applications through monitoring of the network and collection of data from multiple sources.

## Monitoring
Monitoring is done by creating digital twins of the physical sensors and gateways that make up the IoT networks. Since the goal is to increase the dependability of other applications, the Dataport must in itself be dependable. Therefore, it is implemented in Akka, which is a toolkit for creating robust and fault-tolerant application.

## Data collection
In addition to collecting and forwarding the data generated by the monitored IoT applications, the Dataport also collects data from other sources, e.g. weather forecasts.

## Building and running

### Requirements
In order to run the Dataport, you need to add a file `src/main/java/no/ntnu/dataport/utils/SecretStuff.java` that keeps the following variables:

* `VEJLE_APP_EUI`
* `VEJLE_APP_KEY`
* `TRONDHEIM_APP_EUI`
* `TRONDHEIM_APP_KEY`
* `AIRTABLE_BASE_ID`
* `AIRTABLE_API_KEY`
* `SLACK_API_WEBHOOK`
* `INFLUXDB_URL`
* `INFLUXDB_USERNAME`
* `INFLUXDB_PASSWORD`
* `INFLUXDB_DBNAME`
 
### Building it
Create a universal package by using sbt
```
$ sbt universal:packageBin
```
This generates a version with the version number specified in `build.sbt`. In this case, the version is `0.9.10`.

### Uploading it to the server
Upload the generated package to the server
```
$ cd target/universal
$ scp dataport-akka-0.9.10.zip USERNAME@dataport.item.ntnu.no:/home/USERNAME
```
where `USERNAME` is your user with access to dataport.item.ntnu.no.

### Running it on the server
Then, we navigate to the server, kill the old running version and start the new one:
```
$ ssh USERNAME@dataport.item.ntnu.no
$ killall java
$ unzip dataport-akka-0.9.10.zip 
$ chmod u+x dataport-akka-0.9.10/bin/dataport-akka
$ dataport-akka-0.9.10/bin/dataport-akka &
```
NB! The `killall java` will do exactly that - kill all java programs. As of now, the Dataport is the only java program running on the server, and it might be that it will stay like this. But if you're not sure, perhaps do a `ps aux | grep dataport`, and only kill that java instance.

Verify that the Dataport is running correctly by either:

1) Tailing the log file
```
$ tail -f logs/dataport.log
```
2) Checking the map at dataport.item.ntnu.no to see if gateways and sensors send status and reception messages.

NB! It is important to out log of the server before a timeout occurs, otherwise the Java instance might stop running.
```
$ exit
```
